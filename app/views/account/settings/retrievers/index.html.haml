#fiduceo_retrievers.container-fluid
  .row-fluid
    .span3
      = render partial: 'layouts/account/me/navigation'
    .span9
      = render partial: 'navigation'
      .alerts
        = render partial: 'shared/messages'
      .row-fluid
        .span9
          .well
            = render partial: 'list_options'
            %table.table.table-bordered.table-condensed.table-striped.margin1top.margin0bottom
              %thead
                %tr
                  %th= sortable :created_at, t('mongoid.models.common.attributes.created_at')
                  %th= sortable :updated_at, t('mongoid.models.common.attributes.updated_at')
                  %th= sortable :type, t('mongoid.models.fiduceo_retriever.attributes.type')
                  %th= sortable :name, t('mongoid.models.fiduceo_retriever.attributes.name')
                  %th= sortable :state, t('mongoid.models.fiduceo_retriever.attributes.state')
                  %th.last= t('actions.name')
              %tbody
                - @fiduceo_retrievers.each do |fiduceo_retriever|
                  %tr
                    %td= l(fiduceo_retriever.created_at)
                    %td= l(fiduceo_retriever.updated_at)
                    %td= t("mongoid.models.fiduceo_retriever.attributes.type_values.#{fiduceo_retriever.type}")
                    %td= fiduceo_retriever.name
                    %td= FiduceoRetriever.state_machine.states[fiduceo_retriever.state].human_name
                    %td.last
                      - if fiduceo_retriever.scheduled?
                        = link_to icon(icon: 'refresh'), fetch_account_settings_fiduceo_retriever_path(fiduceo_retriever), data: { method: :post, confirm: t('actions.confirm') }, title: 'Récupérer les documents maintenant !'
                      - elsif fiduceo_retriever.wait_user_action?
                        = link_to icon(icon: 'check'), select_documents_account_settings_fiduceo_retriever_path(fiduceo_retriever), title: 'Sélectionner vos documents maintenant'
                      = link_to icon_edit, edit_account_settings_fiduceo_retriever_path(fiduceo_retriever)
                      = link_to icon_destroy, account_settings_fiduceo_retriever_path(fiduceo_retriever), data: { method: :delete, confirm: t('actions.confirm') }
            = render partial: 'list_options'
        .span3
          .well
            = render partial: 'sidebar'