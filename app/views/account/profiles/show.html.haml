.container-fluid
  .row-fluid
    .span12.alerts
      - if flash[:notice].present?
        .alert.alert-success
          %a{ :class=>"close", "data-dismiss"=>"alert" } ×  
          %span= flash[:notice]
      - elsif flash[:credit_alert].present? || flash[:error].present?
        .alert.alert-error
          %a{ :class=>"close", "data-dismiss"=>"alert" } × 
          %span= flash[:credit_alert] || flash[:error]
  .row-fluid
    .span3
      .well.change_pass_parent
        %h3 Changer mon mot de passe
        %br/
        .change_pass
          = form_for @user, :url => account_profile_path do |f|
            - if flash[:alert].present?
              .alert-container
                .alert.alert-error
                  %a{ :class=>"close", "data-dismiss"=>"alert" } × 
                  %span
                    %ul
                      %li
                        Mots de passe invalides
      
            != f.label "Mot de passe actuel :"
            = f.password_field :current_password, :label => "Ancien mot de passe"
            != f.label "Nouveau mot de passe :"
            = f.password_field :password, :label => "Nouveau mot de passe"
            != f.label "Confirmation du mot de passe :"
            = f.password_field :password_confirmation, :label => "Confirmation du nouveau mot de passe"
            != f.submit "Modifier", :class => "btn blue"
    .span6
      .row-fluid
        .span12.gray.well.paymentslist_container
          %h3.aligncenter Mode de paiement
          %br/
          .row-fluid
            /
              .span6
                .paymentslist
                  .header
                    !=radio_button_tag( "use_debit_mandate", "false", ( @user.use_debit_mandate ? false : true ), :id => :pp )
                    %span
                      %a{ :href => "#" }
                        %label{ :for => "pp" } compte prépayé
                  %form{ :method => :get, :action => credit_account_payment_path }
                    .content
                      %span
                        %label{ :for => "amount" } Somme à créditer (€):
                        %input#amount{ :name => "amount", :type => "text", :value => "0.00" }/
                        %br/
                        Payer avec :
                    .footer
                      %input#amount.btn.btn-white.margin1right{ :name => "paypal", :type => "submit", :value => "Paypal" }/
                      %input#amount.btn.btn-white.margin1right{ :name => "cmcic", :type => "submit", :value => "CM-CIC" }/
            .span6
              .paymentslist
                .header
                  !=radio_button_tag( "use_debit_mandate", "true", ( @user.use_debit_mandate ? true : false ), :id => :prlv )
                  %span
                    %a{ :href => "#" }
                      %label{ :for => "prlv" } prélèvement
                .content
                  %span
                    Etat :
                    - if @user.debit_mandate
                      - if @user.debit_mandate.transactionStatus == "success"
                        ok
                      - else
                        information non valide
                    - else
                      non configuré
                  %span
                    Banque : #{@user.debit_mandate.bic rescue ""}
                .footer.padding1bottom
                  %form{ :method => :get, :action => "https://prlv.idocus.com/form.php" }
                    %input.btn.btn-white.margin1right{ :name => :email, :type => "hidden", :value => @user.email }/
                    %input.btn.btn-white.margin1right{ :name => "", :type => "submit", :value => "Configurer" }/
      
      - if @external_file_storage.authorized > 0
        .row-fluid
          .span12.well
            %h3.aligncenter Stockage externe des documents
            %br
            - if @external_file_storage.is_dropbox_basic_authorized?
              - service_number = ExternalFileStorage::F_DROPBOX
              - is_service_used = @external_file_storage.is_used?(service_number)
              %div
                .row-fluid
                  .span12
                    != check_box_tag :enable_dropbox, 1, is_service_used, :id => "service_#{service_number}", :class => "checkbox use_service", :style => "float:left;margin-right:5px;margin-top:0;"
                    %b
                      != label_tag :"service_#{service_number}", "DROPBOX"
                .row-fluid{ :class => "service_config_#{service_number} #{!is_service_used ? 'hide' : ''}" }
                  .span12
                    - if @external_file_storage.dropbox_basic.is_configured?
                      Votre compte iDocus est connecté à votre compte Dropbox. 
                      != link_to "Paramètres", authorize_url_account_dropbox_path
                    - else
                      Pour connecter iDocus à votre compte Dropbox, cliquez
                      != link_to "ici", authorize_url_account_dropbox_path
                    #{"."}
                    %form.margin0bottom{ :action => update_path_settings_account_external_file_storage_path, :method => "POST" }
                      != hidden_field_tag "authenticity_token", form_authenticity_token
                      != label_tag "external_file_storage[dropbox_basic][path]", "Chemin de livraison : ", :class => "pull-left margin1top", :style => "margin-right:4px;"
                      != text_field_tag "external_file_storage[dropbox_basic][path]", "#{@external_file_storage.dropbox_basic.path}", :style => "margin:5px 0 5px 0;font-size:11px;"
                      != submit_tag "valider", :style => "margin:5px 0 5px 0;font-size:11px;"

            - if @external_file_storage.is_google_docs_authorized?
              - service_number = ExternalFileStorage::F_GOOGLE_DOCS
              - is_service_used = @external_file_storage.is_used?(service_number)
              %hr{ :style => "margin:5px 0 5px 0;" }
              %div
                .row-fluid
                  .span12
                    != check_box_tag :enable_google_docs, 1, is_service_used, :id => "service_#{service_number}", :class => "checkbox use_service", :style => "float:left;margin-right:5px;margin-top:0;"
                    %b
                      != label_tag :"service_#{service_number}", "GOOGLE DRIVE"
                .row-fluid{ :class => "service_config_#{service_number} #{!is_service_used ? 'hide' : ''}" }
                  .span12
                    - if @external_file_storage.google_doc.is_configured?
                      Votre compte iDocus est connecté à votre compte Google Drive. 
                      != link_to "Paramètres", authorize_url_account_google_doc_path
                    - else
                      Pour connecter iDocus à votre compte Google Drive, cliquez
                      != link_to "ici", authorize_url_account_google_doc_path
                    #{"."}
                    %form.margin0bottom{ :action => update_path_settings_account_external_file_storage_path, :method => "POST" }
                      != hidden_field_tag "authenticity_token", form_authenticity_token
                      != label_tag "external_file_storage[google_doc][path]", "Chemin de livraison : ", :class => "pull-left margin1top", :style => "margin-right:4px;"
                      != text_field_tag "external_file_storage[google_doc][path]", "#{@external_file_storage.google_doc.path}", :style => "margin:5px 0 5px 0;font-size:11px;"
                      != submit_tag "valider", :style => "margin:5px 0 5px 0;font-size:11px;"

            - if @external_file_storage.is_ftp_authorized?
              - service_number = ExternalFileStorage::F_FTP
              - is_service_used = @external_file_storage.is_used?(service_number)
              %hr{ :style => "margin:5px 0 5px 0;" }
              %div
                .row-fluid
                  .span12
                    != check_box_tag :enable_ftp, 1, is_service_used, :id => "service_#{service_number}", :class => "checkbox use_service", :style => "float:left;margin-right:5px;margin-top:0;"
                    %b
                      != label_tag :"service_#{service_number}", "FTP"
                .row-fluid{ :class => "service_config_#{service_number} #{!is_service_used ? 'hide' : ''}" }
                  .span12
                    - if @external_file_storage.ftp.is_configured?
                      Votre compte iDocus est connecté à votre compte FTP. 
                      != link_to "Paramètres", "#ftpDialog", "data-toggle" => "modal"
                    - else
                      Pour connecter iDocus à votre compte FTP, cliquez
                      != link_to "ici", "#ftpDialog", "data-toggle" => "modal"
                    \.
                    %form.margin0bottom{ :action => update_path_settings_account_external_file_storage_path, :method => "POST" }
                      != hidden_field_tag "authenticity_token", form_authenticity_token
                      != label_tag "external_file_storage[ftp][path]", "Chemin de livraison : ", :class => "pull-left margin1top", :style => "margin-right:4px;"
                      != text_field_tag "external_file_storage[ftp][path]", "#{@external_file_storage.ftp.path}", :style => "margin:5px 0 5px 0;font-size:11px;"
                      != submit_tag "valider", :style => "margin:5px 0 5px 0;font-size:11px;"

        .modal.fade{ :id=>"ftpDialog", :style => "width:333px;height:250px;margin: -125px 0 0 -166px;" }
          .modal-header
            %a{ :class=>"close", "data-dismiss"=>"modal" } ×
            %h3 Configuration du service FTP
          %form.margin0bottom{ :action => configure_account_ftp_path, :method => "POST" }
            .modal-body
              %table
                %tr
                  %td.alignright
                    != label_tag "ftp[host]", "Hôte : "
                  %td
                    != text_field_tag "ftp[host]", @external_file_storage.ftp.host
                %tr
                  %td.alignright
                    != label_tag "ftp[login]", "Identifiant : "
                  %td
                    != text_field_tag "ftp[login]", @external_file_storage.ftp.login
                %tr
                  %td.alignright
                    != label_tag "ftp[password]", "Mots de passe : "
                  %td
                    != password_field_tag "ftp[password]", @external_file_storage.ftp.password
            .modal-footer{ :style => "height: 29px;padding-bottom:12px;" }
              != submit_tag "Valider", :class => "btn"
              %a{ :href=>"#", :class=>"modal-close btn" } Fermer
    .span3
      .well
        %h3.aligncenter Partages
        %br
        Liste des utilisateurs iDocus avec qui vous souhaitez partager systématiquement tous vos nouveaux documents.
        %br
        %br
        %table.table.table-condensed
          - @user.share_with.each do |user|
            %tr
              %td= user.email
              %td= link_to icon_destroy, unshare_documents_with_account_profile_path(email: user.email), method: :delete, data: { confirm: "Voulez-vous vraiment supprimer le partage automatique de vos documents avec #{user.email} ?" }
        %br
        = form_tag share_documents_with_account_profile_path, class: "form form-horizontal" do
          = text_field_tag :email, "", style: 'margin-bottom:0;'
          = submit_tag "Ajouter", class: 'btn'

= render "help"