#pre_assignments{ data: { is_ibiza_configured: @ibiza.try(:is_configured?).to_s } }
  .row-fluid
    .span12.box
      .row-fluid
        .span12
          .pull-left
            %h3 Pré-affectations
          - if is_leader?
            .pull-right
              = icon_link_to "#settings", { icon: 'cog' }, class: 'btn settings', data: { toggle: 'modal' }, title: 'Paramètres'
  .row-fluid
    #pack_reports.span3.box
      %h4.aligncenter Lots
      %hr.margin0top.margin0bottom
      .content
    #preseizures.span5.box
      %h4.aligncenter Pièces/Opérations
      %hr.margin0top.margin0bottom
      .content
    #preseizure_accounts.span4.box
      %h4.aligncenter Ecritures
      %hr.margin0top.margin0bottom
      .content

  #settings.modal.fade
    .modal-header
      %a.close{ data: { dismiss: "modal" } } ×
      %h3.aligncenter Paramètres
    = simple_form_for (@ibiza || Ibiza.new), url: account_organization_ibiza_path, html: { class: 'form form-horizontal' } do |f|
      .modal-body
        .row-fluid
          .span6
            %h4.margin1bottom Connexion à iBiza pour le transfert des écritures
            .control-group.string.optional
              %label.string.optional.control-label= t('mongoid.models.ibiza.attributes.state').capitalize
              .controls
                %span{ class: "label #{ibiza_state_label(@ibiza)}", style: 'position:relative;top:6px;' } #{ibiza_state(@ibiza)}
                %p.help-block
                  - if !@ibiza || @ibiza.state.in?(%w(none invalid))
                    = link_to 'cliquer ici', "https://saas.irf-cloud.com/irfservice/get-token.aspx?partnerId=#{IbizaAPI::Config::PARTNER_ID}"
                    et remplir les champs demandés
            = f.input :token, as: :string, label: t('mongoid.models.ibiza.attributes.token').capitalize, input_html: { class: 'span12' }
            = f.input :is_auto_deliver, as: :boolean, label: t('mongoid.models.ibiza.attributes.is_auto_deliver')
            %h4.margin1bottom Format de nom de la pièce
            %table.table.table-condensed.margin0bottom.field_formatter
              %thead
                %tr
                  %th Valeur
                  %th Position
              %tbody
                %tr
                  %td
                    %label.checkbox
                      = check_box_tag "ibiza[piece_name_format][code][is_used]", 1, (@ibiza.piece_name_format['code']['is_used'] rescue false)
                      Code complet
                  %td= number_field_tag "ibiza[piece_name_format][code][position]", (@ibiza.piece_name_format['code']['position'] rescue 1)
                %tr
                  %td
                    %label.checkbox
                      = check_box_tag "ibiza[piece_name_format][code_wp][is_used]", 1, (@ibiza.piece_name_format['code_wp']['is_used'] rescue false)
                      Code dossier sans code cabinet
                  %td= number_field_tag "ibiza[piece_name_format][code_wp][position]", (@ibiza.piece_name_format['code_wp']['position'] rescue 1)
                %tr
                  %td
                    %label.checkbox
                      = check_box_tag "ibiza[piece_name_format][journal][is_used]", 1, (@ibiza.piece_name_format['journal']['is_used'] rescue false)
                      Journal
                  %td= number_field_tag "ibiza[piece_name_format][journal][position]", (@ibiza.piece_name_format['journal']['position'] rescue 1)
                %tr
                  %td
                    %label.checkbox
                      = check_box_tag "ibiza[piece_name_format][period][is_used]", 1, (@ibiza.piece_name_format['period']['is_used'] rescue false)
                      Période traitement
                  %td= number_field_tag "ibiza[piece_name_format][period][position]", (@ibiza.piece_name_format['period']['position'] rescue 1)
                %tr
                  %td
                    %label.checkbox
                      = check_box_tag "ibiza[piece_name_format][number][is_used]", 1, (@ibiza.piece_name_format['number']['is_used'] rescue false)
                      Numéro
                  %td= number_field_tag "ibiza[piece_name_format][number][position]", (@ibiza.piece_name_format['number']['position'] rescue 1)
            = f.input :piece_name_format_sep, label: t('mongoid.models.ibiza.attributes.piece_name_format_sep'), input_html: { class: 'span3' }
          .span6
            %h4.margin1bottom Format de la description
            %table.table.table-condensed.margin0bottom.field_formatter
              %thead
                %tr
                  %th Valeur
                  %th Position
              %tbody
                %tr
                  %td
                    %label.checkbox
                      = check_box_tag "ibiza[description][date][is_used]", 1, (@ibiza.description['date']['is_used'] rescue false)
                      Date réelle
                  %td= number_field_tag "ibiza[description][date][position]", (@ibiza.description['date']['position'] rescue 1)
                %tr
                  %td
                    %label.checkbox
                      = check_box_tag "ibiza[description][third_party][is_used]", 1, (@ibiza.description['third_party']['is_used'] rescue false)
                      Tiers
                  %td= number_field_tag "ibiza[description][third_party][position]", (@ibiza.description['third_party']['position'] rescue 1)
                %tr
                  %td
                    %label.checkbox
                      = check_box_tag "ibiza[description][amount][is_used]", 1, (@ibiza.description['amount']['is_used'] rescue false)
                      Montant d'origine
                  %td= number_field_tag "ibiza[description][amount][position]", (@ibiza.description['amount']['position'] rescue 1)
                %tr
                  %td
                    %label.checkbox
                      = check_box_tag "ibiza[description][currency][is_used]", 1, (@ibiza.description['currency']['is_used'] rescue false)
                      Devise
                  %td= number_field_tag "ibiza[description][currency][position]", (@ibiza.description['currency']['position'] rescue 1)
                %tr
                  %td
                    %label.checkbox
                      = check_box_tag "ibiza[description][conversion_rate][is_used]", 1, (@ibiza.description['conversion_rate']['is_used'] rescue false)
                      Taux de conversion
                  %td= number_field_tag "ibiza[description][conversion_rate][position]", (@ibiza.description['conversion_rate']['position'] rescue 1)
                %tr
                  %td
                    %label.checkbox
                      = check_box_tag "ibiza[description][observation][is_used]", 1, (@ibiza.description['observation']['is_used'] rescue false)
                      Remarque
                  %td= number_field_tag "ibiza[description][observation][position]", (@ibiza.description['observation']['position'] rescue 1)
                %tr
                  %td
                    %label.checkbox
                      = check_box_tag "ibiza[description][journal][is_used]", 1, (@ibiza.description['journal']['is_used'] rescue false)
                      Journal
                  %td= number_field_tag "ibiza[description][journal][position]", (@ibiza.description['journal']['position'] rescue 1)
                %tr
                  %td
                    %label.checkbox
                      = check_box_tag "ibiza[description][piece_name][is_used]", 1, (@ibiza.description['piece_name']['is_used'] rescue false)
                      Nom de pièce (iDocus)
                  %td= number_field_tag "ibiza[description][piece_name][position]", (@ibiza.description['piece_name']['position'] rescue 1)
                %tr
                  %td
                    %label.checkbox
                      = check_box_tag "ibiza[description][piece_number][is_used]", 1, (@ibiza.description['piece_number']['is_used'] rescue false)
                      Référence pièce
                  %td= number_field_tag "ibiza[description][piece_number][position]", (@ibiza.description['piece_number']['position'] rescue 1)
            = f.input :description_separator, label: t('mongoid.models.ibiza.attributes.description_separator'), input_html: { class: 'span3' }
      .modal-footer
        %a.btn{ data: { dismiss: "modal" } } Fermer
        = f.submit t('actions.submit'), class: 'btn btn-primary'
