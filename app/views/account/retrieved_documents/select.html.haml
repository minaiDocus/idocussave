#retrieved_documents.select.row-fluid
  .span12
    .box
      .row-fluid
        .span6
          %h3 Sélection de documents restant à récupérer (#{@documents.count})
        .span6
          = link_to "#{@is_filter_empty ? 'Afficher' : 'Cacher'} le filtre", '#', class: 'btn pull-right toggle_filter'
    .filter.box{ class: ('hide' if @is_filter_empty) }
      = form_tag select_account_retrieved_documents_path, method: :get, class: 'form form-vertical margin0bottom' do
        %table.table-condensed
          %thead
            %tr
              %th= label_tag 'document_contains[service_name]',     'Service'
              %th= label_tag 'document_contains[date][$gte]',       'Date de début'
              %th= label_tag 'document_contains[date][$lte]',       'Date de fin'
              %th= label_tag 'document_contains[name]',             'Nom original'
              %th
          %tbody
            %tr
              %td
                - if @retriever
                  .label= @retriever.name
                  = hidden_field_tag 'document_contains[retriever_id]', @retriever.id
                - else
                  = text_field_tag 'document_contains[service_name]', (params[:document_contains][:service_name] rescue ''), class: 'input-medium'
              %td
                .input-append.date.datepicker
                  = text_field_tag 'document_contains[date][$gte]', (params[:document_contains][:date]['$gte'] rescue ''), class: 'input-small'
                  %span.add-on
                    %i.icon-th
              %td
                .input-append.date.datepicker
                  = text_field_tag 'document_contains[date][$lte]', (params[:document_contains][:date]['$lte'] rescue ''), class: 'input-small'
                  %span.add-on
                    %i.icon-th
              %td= text_field_tag 'document_contains[name]', (params[:document_contains][:name] rescue ''), class: 'input-medium'
              %td
                = submit_tag t('filters.action'), class: 'btn btn-primary'
                = link_to icon(icon: 'remove'), select_account_retrieved_documents_path, class: 'btn', title: t('filters.reset')
    .box{ style: 'padding-bottom:0;' }
      = form_tag validate_account_retrieved_documents_path, method: 'PUT', class: 'form form-horizontal' do
        = hidden_field_tag 'document_contains[retriever_id]', @retriever.id if @retriever
        = hidden_field_tag 'document_contains[service_name]', (params[:document_contains][:service_name] rescue '')
        = hidden_field_tag 'document_contains[date][$gte]',   (params[:document_contains][:date]['$gte'] rescue '')
        = hidden_field_tag 'document_contains[date][$lte]',   (params[:document_contains][:date]['$lte'] rescue '')
        = hidden_field_tag 'document_contains[name]',         (params[:document_contains][:name] rescue '')
        = render partial: 'list_options'
        %table.table.table-bordered.table-condensed.table-striped.margin1top.margin0bottom
          %thead
            %tr
              %th= check_box_tag 'master_checkbox', 0, false
              %th= sortable :created_at,                      'Date de la récupération'
              %th= sortable :retriever_id,                    'Service'
              %th= sortable 'fiduceo_metadata.date',          'Date'
              %th= sortable 'fiduceo_metadata.libelle',       'Nom original'
              %th.pages= sortable :pages_number,              'Nb. pages'
              %th.amount= sortable 'fiduceo_metadata.amount', 'Montant'
          %tbody
            - @documents.each do |document|
              %tr
                %td= check_box_tag "document_ids[]", document.id, false, class: 'checkbox'
                %td= l(document.created_at)
                %td
                  - if document.fiduceo_retriever.nil?
                    %span.label supprimé
                  = document.fiduceo_custom_service_name
                %td= l(document.fiduceo_metadata['date'], format: '%d %b %Y')
                %td= link_to document.fiduceo_metadata['libelle'] + '.pdf', account_retrieved_document_path(document)
                %td.pages= document.pages_number
                %td.amount= document.fiduceo_metadata['amount'].to_s + ' €'
        = render partial: 'list_options'
        .form-actions
          = submit_tag 'Intégrer les documents sélectionnés', class: 'btn btn-primary', data: { confirm: t('actions.confirm') }
