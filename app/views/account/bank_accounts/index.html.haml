#bank_accounts.select.row-fluid
  .span12
    .box
      .row-fluid
        .span6
          %h3 Paramétrage des automates bancaires (#{@bank_accounts.count})
        .span6
          = link_to "#{@is_filter_empty ? 'Afficher' : 'Cacher'} le filtre", '#', class: 'btn pull-right toggle_filter'
    .filter.box{ class: ('hide' if @is_filter_empty) }
      = form_tag account_bank_accounts_path, method: :get, class: 'form form-vertical margin0bottom' do
        %table.table-condensed
          %tr
            %th= label_tag 'bank_account_contains[retriever_id]', 'Banque'
            %td= select_tag 'bank_account_contains[retriever_id]', options_for_select(@user.fiduceo_retrievers.banks.map { |e| [e.name, e.id] }, (params[:bank_account_contains][:retriever_id] rescue nil)), include_blank: true
            %td
              = submit_tag t('filters.action'), class: 'btn btn-primary'
              = link_to icon(icon: 'remove'), account_bank_accounts_path, class: 'btn', title: t('filters.reset')
    .box{ style: 'padding-bottom:0;' }
      = form_tag update_multiple_account_bank_accounts_path, method: 'patch', class: 'form form-horizontal' do
        = hidden_field_tag 'bank_account_contains[retriever_id]', @retriever.id if @retriever
        %table.table.table-bordered.table-condensed.table-striped.margin1top.margin0bottom
          %thead
            %tr
              %th= check_box_tag 'master_checkbox', 0, false
              %th Banque
              %th Numéro de compte
          %tbody
            - @bank_accounts.each do |bank_account|
              %tr
                %td
                  - if bank_account.bank_name.present?
                    = hidden_field_tag "bank_accounts[#{bank_account.fiduceo_id}]", 0, id: "bank_accounts_#{bank_account.id}"
                    = check_box_tag "bank_accounts[#{bank_account.fiduceo_id}]", 1, bank_account.persisted?, class: 'checkbox'
                %td= label_tag "bank_accounts[#{bank_account.fiduceo_id}]", bank_account.bank_name.presence || '(inconnu)'
                %td= label_tag "bank_accounts[#{bank_account.fiduceo_id}]", bank_account.number
        .form-actions
          = submit_tag 'Valider les changements', class: 'btn btn-primary', data: { confirm: t('actions.confirm') }
