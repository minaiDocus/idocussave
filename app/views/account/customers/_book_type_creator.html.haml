= simple_form_for @journal, url: '', html: { class: 'form-horizontal label-50', id: "account_book_type"} do |f|  
  .row
    %input#new_create_book_type{ type: :hidden, value: "1", name: "new_create_book_type"}
    %input#customer_id{ type: :hidden, value: "#{@customer.id}", name: "customer_id"}
    .col-md-6
      .box.small-shadow          
        = f.input :name, label: 'Attribuez un nom de code journal iDocus', hint: 'Ce code doit si possible être similaire à celui utilisé dans votre outil comptable. La modification de ce code journal n’est possible que pendant 24 heures.'
        = f.input :description, label: 'Nom du journal comptable iDocus', hint: 'Inscrivez ici entre parenthès le nom du journal comptable iDocus. Exemple (Achats). Ceci est nécessaire pour les utilisateurs du forfait iDo’Courrier notamment.'
        - if @customer && @customer.uses_ibiza? && @organization.ibiza.try(:configured?)
          - collection = journals_for_select(@journal.pseudonym)
        - else
          - collection = nil
        = f.input :pseudonym, label: 'Quel est le code journal comptable de votre outil comptable à associer ?', collection: collection, hint: (collection.present? ? 'Choisissez dans le menu déroulant les journaux comptables issus de la connexion avec votre outil comptable.' : nil)
        - if @customer && @customer.uses_ibiza? && !@organization.ibiza.try(:configured?)
          %p.margin2bottom.margin30left
            = render 'shared/ibiza_not_configured_warning'

        - if @organization.knowings.try(:is_configured?)
          .box.bg-light
            %h4 Knowings
            %hr
            = f.input :domain, label: 'A quel domaine Knowings souhaitez-vous rattacher le journal comptable iDocus ?', collection: journal_domain_for_select, include_blank: false
        - if @journal.persisted? && (!@customer || @customer.options.is_preassignment_authorized)
          = f.input :entry_type, collection: [[t('simple_form.labels.account_book_type.entry_type_0'),0], [t('simple_form.labels.account_book_type.entry_type_1'),1], [t('simple_form.labels.account_book_type.entry_type_2'),2], [t('simple_form.labels.account_book_type.entry_type_3'),3]], include_blank: false, input_html: { class: 'persisted' }
        - if !@customer || @customer.subscription.is_mail_package_active
          = f.input :instructions, as: :text, input_html: { maxlength: 400 }

    .col-md-6
      - is_disabled = @customer.present? && @customer.options.is_preassignment_authorized
      .box.small-shadow#pre-saisie{ class: "#{ (@journal.persisted? && @journal.entry_type.in?([0,1]) )? 'hide' : '' }"}
        .header_box.text-left.mb-5.border_bottom Pré-saisie comptable
        - if !@journal.persisted?
          = f.input :entry_type, label: 'Sélectionnez le type de pré-saisie comptable pour le journal', collection: [[t('simple_form.labels.account_book_type.entry_type_0'),0], [t('simple_form.labels.account_book_type.entry_type_1'),1], [t('simple_form.labels.account_book_type.entry_type_2'),2], [t('simple_form.labels.account_book_type.entry_type_3'),3]], include_blank: false, input_html: { class: 'not_persisted' }
        #pre-assignment-attributes{ class: "#{!@journal.persisted? && @journal.entry_type.in?([0,1]) ? 'hide' : '' }"}
          = f.input :currency, collection: journal_currencies, include_blank: false, selected: "EUR", hint: "Les écritures seront converties vers cette devise avec le taux de change de la date de facture"
          = f.input :account_type, label: 'Souhaitez-vous configurer le journal en compte d’attente ou compte par défaut?', collection: [["Compte d'attente", 'waiting'], ["Compte par défaut", 'default']], include_blank: false
          .form-group.clearfix
            .label-section
              %label
            .control-section            
              .account_type_help.margin2bottom
                %i
                  %u Compte d’attente:
                la pré-saisie comptable sera effectuée avec les informations issues du plan comptable de votre outil comptable. Si il n’y a pas d’informations dans ce plan de compte, iDocus saisira les écritures dans les comptes d’attente paramétrés ici.
                %br
                %i
                  %u Compte par défaut:
                iDocus saisira
                %b systématiquement
                toutes les factures déposées dans le journal comptable sur les comptes paramétrés sans se référer au plan comptable.
          = f.input :meta_account_number, input_html: { class: 'can_be_required' }
          = f.input :meta_charge_account, input_html: { class: 'can_be_required' }
          - if !@customer || @customer.options.is_taxable
            - hint = !@customer ? 'obligatoire mais ne sera utilisé que pour les clients assujettis à la TVA' : ''
            = f.input :vat_account, label: 'Quel est le compte de TVA 20% attribué au Journal Comptable iDocus (le cas échéant) ? Exemple: 445660', input_html: { class: 'can_be_required' }, hint: hint
            = f.input :vat_account_10
            = f.input :vat_account_8_5
            = f.input :vat_account_5_5
            = f.input :vat_account_2_1
          = f.input :anomaly_account, label: 'Quel est le compte à utiliser en cas d’anomalie ?', input_html: { class: 'can_be_required' }, hint: 'si aucune information claire dans la pièce, si la pièce n’est pas une facture, …'