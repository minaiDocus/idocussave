.block
  .secondary-navigation
    %ul.wat-cf
      %li.first.active!= link_to "All users", admin_users_path
      %li!= link_to "Add user", new_admin_user_path
  .content
    %h2.title All users
    .inner
      %form{ :method => "GET", :action => admin_users_path }
        %h3 Filtre
        %table.table
          %tr
            %th
              %label{ :for => :company } Company
            %th
              %label{ :for => :code } Code
            %th
              %label{ :for => :first_name } Nom
            %th
              %label{ :for => :last_name } Prénom
            %th.last
              %label{ :for => :email } Email
          %tr
            %td
              %input{ :type => :text, :name => :company, :id => :company, :value => (params[:company] rescue "") }
            %td
              %input{ :type => :text, :name => :code, :id => :code, :value => (params[:code] rescue "") }
            %td
              %input{ :type => :text, :name => :first_name, :id => :first_name, :value => (params[:first_name] rescue "") }
            %td
              %input{ :type => :text, :name => :last_name, :id => :last_name, :value => (params[:last_name] rescue "") }
            %td.last
              %input{ :type => :text, :name => :email, :id => :email, :value => (params[:email] rescue "") }
            
        .group.navform.wat-cf
          %button.button{:type => 'submit'}
            != image_tag("web-app-theme/tick.png", :alt => "Valider")
            Valider
          != link_to image_tag("web-app-theme/cross.png", :alt => "Effacer le filtre") + "Effacer le filtre", admin_users_path, :class => "button"
        
      %br
      %br
      %br
      %table.table
        %tr
          %th Identifier
          %th
            Company
            %br
            Code
          %th Admin?
          %th Confirmed?
          %th Status
          %th.last &nbsp;
        - @users.each do |user|
          %tr{:class => cycle("odd", "even")}
            %td
              != user.email
              - if user.first_name || user.last_name
                %br
                != user.first_name rescue ""
                - if user.first_name
                  #{" "}
                != user.last_name rescue ""
            %td
              != user.company rescue ""
              - if user.company
                %br
              != user.code rescue ""
            %td!= (user.is_admin)? 'oui' : 'non'
            %td
              - if user.confirmed?
                != 'oui'
              - else
                != 'non, confirmer? '
                != check_box_tag 'confirmed?', true, false, :class => "inplace", :id => user.id
                != image_tag "lightbox-ico-loading.gif", :style => "display:none;", :id => "spinner_#{user.id}"
            %td
              %select{ :name => :delivery_state, :id => user.id, :class => :delivery_state }
                - Delivery::STATES.each do |state|
                  - same = (user.delivery.state == state[1]) rescue false
                  - if same
                    %option{ :value => state[1], :selected => :selected }
                      !=state[0]
                  - else
                    %option{ :value => state[1] }
                      !=state[0]
              != image_tag "lightbox-ico-loading.gif", :style => "display:none;", :id => "spinner_2_#{user.id}"
            %td.last
              != link_to image_tag("web-app-theme/application_edit.png", :alt => "Edit"), edit_admin_user_path(user)
              -#|
              -#!= link_to image_tag("web-app-theme/cross.png", :alt => "delete"), admin_user_path(user), :method => :delete, :confirm => "Êtes-vous sûr ?"
      .actions-bar.wat-cf
        .actions
        != will_paginate @users
        
- content_for :sidebar, render(:partial => 'sidebar')

:javascript
  $(document).ready(function () {
    $("input[type=checkbox].inplace").click(function(){
      uid = $(this).attr('id');
      node = $(this);
      url = "/admin/users/" + uid + "/update_confirm_status";
      hsh = {value: $(this).is(':checked')};
      spinner_id = "#spinner_"+uid;
      $.ajax({
        url: url,
        data: hsh,
        dataType: "json",
        type: "POST",
        beforeSend: function() {
          node.hide();
          $(spinner_id).show();
        },
        success: function(data){
          $(spinner_id).hide();
          node.parent().html('oui');
        }
      });
    });
    
    $("select").change(function(){
      uid = $(this).attr('id');
      node = $(this);
      url = "/admin/users/" + uid + "/update_delivery_status";
      hsh = {value: $(this).val()};
      spinner_id = "#spinner_2_"+uid;
      $.ajax({
        url: url,
        data: hsh,
        dataType: "json",
        type: "POST",
        beforeSend: function() {
          node.hide();
          $(spinner_id).show();
        },
        success: function(data){
          $(spinner_id).hide();
          node.show();
        }
      });
    });
  });
  
:css
  .w50 {
    width: 50px; }
  .w75 {
    width: 75px; }